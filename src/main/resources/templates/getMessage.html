<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous" />
<link rel="stylesheet" th:href="@{/css/getMessage.css}"/>
<head>
    <p class="text-center" id="title">Note management panel</p>
</head>
<body>
<div id="main-section">
    <div class="clearfix" id="main-section-container">
        <div class="alert alert-warning text-center" id="no-notes-warning" th:if="${#lists.size(messages) == 0}">
            No notes present!
        </div>
        <!-- Table with main notes -->
        <table class="table" id="main-section-table" th:if="${#lists.size(messages) > 0}">
            <thead>
            <tr>
                <th id="main-section-table-note" scope="col">Note</th>
                <th scope="col">Time of the last action</th>
            </tr>
            </thead>
            <tbody>
            <tr scope="col" th:each="note : ${messages}">
                <td th:text="${note.message}">Note</td>
                <td th:text="${note.timeOfCreation}">Time of the last action</td>
                <td>
                    <form th:action="@{/message/panel/delete}" th:method="post">
                        <input id = "main-section-table-delete-input"
                               th:value="${note.messageId}"
                               type="text"
                               name="messageId"/>
                        <button
                                class="btn btn-danger pull-right"
                                id="main-section-table-delete-button"
                                type="submit">
                            delete
                        </button>
                        <button th:m-id="${note.messageId}" th:m="${note.message}"
                                class="btn btn-primary pull-right"
                                id="main-section-table-edit-button"
                                type="button"
                                onclick="editUpdateForm(this.getAttribute('m-id'), this.getAttribute('m'))">
                            edit
                        </button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
        <!-- Form for addition of notes.  -->
        <p class="text-center" id="main-section-add-note-title">Add note</p>
        <form th:action="@{/message/panel/create}" th:object="${messageDto}" th:method="post">
					<textarea
                            maxlength="1000"
                            class="form-control"
                            id="main-section-add-note-textarea"
                            placeholder="1000 or less characters"
                            rows="10"
                            type="text"
                            th:field="*{message}"/>
            <button type="submit" id="main-section-add-note-button" class="btn btn-success btn-outline pull-right">Add</button>
            <div class="alert alert-warning" th:if="${#fields.hasErrors('message')}" th:errors="*{message}"></div>
        </form>
    </div>
</div>
<!-- Form for update of notes. Opens only when the button for edit is pressed. -->
<div id="update-note-popup">
    <form th:action="@{/message/panel/update}" th:object="${messageDto}" th:method="post">
        <p class="text-center" id="update-note-popup-title">Update note</p>
        <div class="clearfix">
            <button
                    type="button"
                    class="btn btn-secondary pull-left"
                    data-bs-dismiss="modal"
                    id="update-note-popup-close-button"
                    onclick="closeUpdateForm()">
                x
            </button>
        </div>
        <input type="text" id="update-note-input" th:field="*{messageId}"/>
        <textarea
                maxlength="1000"
                placeholder="1000 or less characters"
                class="form-control"
                id="update-note-textarea"
                type="text"
                th:field="*{message}"/>
        <button
                type="submit"
                id="update-note-button"
                class="btn btn-success btn-outline pull-right"
                onclick="validateUpdateField()">
            Update
        </button>
    </form>
</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
<script th:src="@{/js/getMessage.js}"></script>
</html>